<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>J & V — Invitación de Boda</title>

  <style>
:root{
  --bGold: rgba(201,151,43,.34);
  --bChamp: rgba(241,209,138,.32);
  --bCream: rgba(255,248,235,.34);
  --bWhite: rgba(255,255,255,.26);
  --easeWarm: cubic-bezier(.18,.86,.22,1);
}

*{ box-sizing:border-box; }
img{ max-width:100%; height:auto; }
html, body{ width:100%; height:100%; margin:0; }

body{
  display:grid;
  place-items:center;

  min-height:100vh;
  min-height:100svh;
  min-height:100dvh;

  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#fff;
  overflow:hidden;
  padding:18px;
  text-align:center;
  color:#222;
  position:relative;
}

/* Fondo base */
.bg-base{
  position:fixed;
  inset:0;
  z-index:0;
  background: linear-gradient(135deg,
    #ffffff 0%,
    #fff6e6 25%,
    #f1d18a 55%,
    #fffaf1 80%,
    #ffffff 100%);
  background-size:300% 300%;
  animation: baseMove 7s ease-in-out infinite;
  pointer-events:none;
  will-change: filter, opacity;
}

#bubblesCanvas{
  position:fixed;
  inset:0;
  z-index:1;
  pointer-events:none;
  display:block;
  opacity:0.92;
  mix-blend-mode: normal;
  filter: saturate(1.06) contrast(1.10);
  will-change: filter, opacity;
}

.shimmer{
  position:fixed;
  inset:-25%;
  z-index:2;
  pointer-events:none;
  background: linear-gradient(115deg,
    rgba(255,255,255,0) 0%,
    rgba(241,209,138,.65) 45%,
    rgba(255,255,255,0) 60%
  );
  filter: blur(10px);
  opacity:.5;
  animation: shimmerMove 7s ease-in-out infinite;
  will-change: filter, opacity, transform;
}

@keyframes baseMove{
  0%{ background-position:0% 50%; }
  50%{ background-position:100% 50%; }
  100%{ background-position:0% 50%; }
}
@keyframes shimmerMove{
  0%{ transform:translateX(-40%) rotate(6deg); }
  50%{ transform:translateX(10%) rotate(6deg); }
  100%{ transform:translateX(45%) rotate(6deg); }
}

/* Sobres */
.cover{
  width: min(720px, 92vw);
  max-height: 86svh;
  max-height: 86dvh;
  height: auto;
  display:block;
  cursor:pointer;
  user-select:none;
  -webkit-user-drag:none;

  filter: drop-shadow(0 18px 35px rgba(0,0,0,.16));
  transition: transform .25s ease, filter .25s ease, opacity .25s ease;
  will-change: transform, opacity, filter;
}
@media (min-width: 900px){
  .cover{ width: clamp(468px, 34vw, 684px); max-height: 82vh; }
}
@media (max-width: 520px){
  .cover{ width: 92vw; max-height: 84svh; max-height: 84dvh; }
}

.cover-wrap{
  position: relative;
  display: grid;
  place-items: center;
  z-index:10;
  will-change: filter, opacity;
}

.hint{
  position: absolute;
  left: 50%;
  bottom: 10%;
  transform: translateX(-50%);
  width: 92%;
  max-width: 520px;

  font-size: 1.15rem;
  letter-spacing: 1.6px;
  color: rgba(80,80,80,.72);
  text-transform: uppercase;

  opacity: 0;
  animation: hintIn .7s ease forwards;
  animation-delay: 1s;

  pointer-events: none;
  user-select: none;
}
@keyframes hintIn{
  from{ opacity:0; transform: translateX(-50%) translateY(6px); }
  to  { opacity:1; transform: translateX(-50%) translateY(0); }
}
@media (max-width: 520px){
  .hint{
    bottom: 14%;
    font-size: .95rem;
    letter-spacing: 1.2px;
  }
}

/* Transición sobres */
.cover-open{
  position:absolute;
  opacity:0;
  visibility:hidden;
  transform: translateY(10px) scale(0.99);
  pointer-events:none;
  transition:
    opacity 1.30s var(--easeWarm),
    transform 1.30s var(--easeWarm);
}
.cover.is-press{
  transform: scale(0.985);
  filter: drop-shadow(0 12px 26px rgba(0,0,0,.14));
}
.cover.is-fadeout{
  opacity:0;
  transform: translateY(-6px) scale(0.995);
  filter: drop-shadow(0 18px 35px rgba(0,0,0,.12));
  transition:
    opacity 1.30s var(--easeWarm),
    transform 1.30s var(--easeWarm),
    filter 1.30s var(--easeWarm);
}
.cover-open.is-show{
  opacity:1;
  visibility:visible;
  transform: translateY(0) scale(1);
}
.cover-open.is-reveal{
  opacity:0;
  transform: translateY(-10px) scale(1.01);
  transition:
    opacity 1.10s var(--easeWarm),
    transform 1.10s var(--easeWarm);
}

/* Texto Bienvenidos */
.welcome{
  position:absolute;
  left:50%;
  bottom: 6.8%;
  transform: translateX(-50%);
  width: 92%;
  max-width: 560px;

  font-family: "Georgia", "Times New Roman", serif;
  font-size: 1.15rem;
  letter-spacing: 1.2px;

  color: rgba(166, 128, 56, .78);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);

  opacity: 0;
  pointer-events:none;
  user-select:none;

  animation: none;
  will-change: opacity, transform;
}
.welcome.is-animate{
  animation: hintIn .7s ease forwards;
}
@keyframes welcomeOut{
  from{ opacity:1; transform: translateX(-50%) translateY(0); }
  to  { opacity:0; transform: translateX(-50%) translateY(-6px); }
}
.welcome.is-out{
  animation: welcomeOut .85s var(--easeWarm) forwards;
}
@media (max-width: 520px){
  .welcome{
    bottom: 10.5%;
    font-size: 1.00rem;
    letter-spacing: 1.0px;
  }
}

/* =========================================================
   ✅ TRANSICIÓN FLUIDA: IRIS / RADIAL WIPE (UNA SOLA CAPA)
   ✅ FIX: último “pedacito” -> exterior se vuelve blanco gradual
   ========================================================= */

/* ✅ Propiedades animables */
@property --wipeR {
  syntax: "<length>";
  inherits: false;
  initial-value: 90px;
}
@property --wipeOuterA {
  syntax: "<number>";
  inherits: false;
  initial-value: 0;
}
@property --wipeSoft {
  syntax: "<length>";
  inherits: false;
  initial-value: 160px;
}

#wipe{
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0;

  /* origen: esquina superior izquierda */
  --wipeX: 0px;
  --wipeY: 0px;

  /* radio + suavidad */
  --wipeR: 90px;
  --wipeSoft: 160px;

  /* opacidad del blanco exterior (0->1 al final) */
  --wipeOuterA: 0;

  /* ✅ el exterior deja de ser transparente de forma PROGRESIVA */
  background: radial-gradient(
    circle at var(--wipeX) var(--wipeY),
    rgba(255,255,255,1) 0px,
    rgba(255,255,255,1) calc(var(--wipeR) - var(--wipeSoft)),
    rgba(255,255,255,var(--wipeOuterA)) var(--wipeR),
    rgba(255,255,255,var(--wipeOuterA)) 200%
  );

  filter: blur(0px);
  will-change: opacity, filter, background;
}

/* activación */
body.is-wiping #wipe{
  opacity: 1;
  animation: wipeGrow var(--wipeDur, 3600ms) var(--easeWarm) forwards;
}

/* blur progresivo del “mundo” mientras entra el wipe */
.bg-base, #bubblesCanvas, .shimmer, #coverWrap{
  transition:
    filter var(--wipeDur, 3600ms) var(--easeWarm),
    opacity var(--wipeDur, 3600ms) var(--easeWarm);
}

body.is-wiping #bubblesCanvas{
  filter: saturate(1.03) contrast(1.07) blur(18px);
  opacity: .25;
}
body.is-wiping .shimmer{
  filter: blur(28px);
  opacity: .10;
}
body.is-wiping .bg-base{
  filter: blur(16px);
  opacity: .30;
}
body.is-wiping #coverWrap{
  filter: blur(14px);
  opacity: .15;
}

/* ✅ Animación: crece + “cierra” exterior hacia blanco */
@keyframes wipeGrow{
  0%{
    --wipeR: 90px;
    --wipeOuterA: 0;
    --wipeSoft: 160px;
    filter: blur(0px);
  }
  55%{
    --wipeR: 85vmax;
    --wipeOuterA: 0;
    --wipeSoft: 200px;
    filter: blur(10px);
  }
  85%{
    --wipeR: 150vmax;
    --wipeOuterA: .55;
    --wipeSoft: 240px;
    filter: blur(14px);
  }
  100%{
    --wipeR: 260vmax;   /* ✅ más grande para cualquier pantalla */
    --wipeOuterA: 1;    /* ✅ full blanco, cero transparencia */
    --wipeSoft: 260px;
    filter: blur(18px);
  }
}

@media (prefers-reduced-motion: reduce){
  .cover, .cover-open, .welcome,
  #wipe,
  #bubblesCanvas, .shimmer, #coverWrap, .bg-base{
    transition:none !important;
    animation:none !important;
    filter:none !important;
    transform:none !important;
  }
}
  </style>
</head>

<body>
  <div class="bg-base"></div>
  <canvas id="bubblesCanvas"></canvas>
  <div class="shimmer"></div>

  <div class="cover-wrap" id="coverWrap">
    <img src="assets/Sobre-Cerrado.png" alt="Sobre cerrado" class="cover" id="coverClosed" />
    <img src="assets/Sobre.png" alt="Sobre abierto" class="cover cover-open" id="coverOpen" />
    <div class="hint" id="hint">Toca el sobre para abrir</div>
    <div class="welcome" id="welcome">Bienvenidos a nuestra Historia</div>
  </div>

  <!-- ✅ Wipe overlay -->
  <div id="wipe" aria-hidden="true"></div>

  <audio id="bg-music" preload="auto">
    <source src="assets/MusicaparaBoda.m4a" type="audio/mp4">
    Tu navegador no soporta audio.
  </audio>

  <script>
    const coverClosed = document.getElementById("coverClosed");
    const coverOpen   = document.getElementById("coverOpen");
    const music = document.getElementById("bg-music");
    const hint  = document.getElementById("hint");
    const welcome = document.getElementById("welcome");
    const wipe = document.getElementById("wipe");

    let opened = false;

    function runWipeTransition({ duration = 3600 } = {}) {
      // duración global para blur + wipe
      document.documentElement.style.setProperty("--wipeDur", duration + "ms");

      // origen top-left consistente
      if (wipe){
        wipe.style.setProperty("--wipeX", "0px");
        wipe.style.setProperty("--wipeY", "0px");
      }

      document.body.classList.add("is-wiping");

      // al terminar: dejar todo BLANCO (y listo para mostrar tu contenido real)
      window.setTimeout(() => {
        document.body.style.background = "#fff";

        const canvas = document.getElementById("bubblesCanvas");
        const shimmer = document.querySelector(".shimmer");
        const bg = document.querySelector(".bg-base");
        const wrap = document.getElementById("coverWrap");

        if (canvas) canvas.style.display = "none";
        if (shimmer) shimmer.style.display = "none";
        if (bg) bg.style.display = "none";
        if (wrap) wrap.style.display = "none";

        // IMPORTANTE: NO tocamos la música, sigue.
        // Aquí luego metes tu segunda "página" / contenido:
        // document.getElementById("contenido").style.display = "block";
      }, duration);
    }

    coverClosed.addEventListener("click", async () => {
      if (opened) return;
      opened = true;

      if (hint) hint.style.display = "none";

      const PRESS_MS = 150;
      const CLOSED_FADE_MS = 1400;
      const OPEN_FADE_MS = 1200;
      const OPEN_HOLD_MS = 2500;

      const WELCOME_DELAY_AFTER_OPEN = 850;

      // primero texto, luego sobre
      const WELCOME_OUT_MS = 850;   // coincide con .85s
      const GAP_BEFORE_REVEAL = 180;

      // ✅ más lenta y “humana”
      const WIPE_MS = 3800; // prueba 3800–4500 si quieres aún más cine

      coverClosed.classList.add("is-press");
      setTimeout(() => coverClosed.classList.remove("is-press"), PRESS_MS);

      if (music.paused) {
        music.play().catch(e => console.error("No se pudo reproducir audio:", e));
      }

      const T0 = 120;

      // cerrado se va
      setTimeout(() => {
        coverClosed.classList.add("is-fadeout");
      }, T0);

      // abierto aparece
      setTimeout(() => {
        coverOpen.classList.add("is-show");
      }, T0 + CLOSED_FADE_MS);

      // texto aparece después
      setTimeout(() => {
        if (welcome) welcome.classList.add("is-animate");
      }, T0 + CLOSED_FADE_MS + WELCOME_DELAY_AFTER_OPEN);

      // texto se va
      setTimeout(() => {
        if (welcome) welcome.classList.add("is-out");
      }, T0 + CLOSED_FADE_MS + OPEN_FADE_MS + OPEN_HOLD_MS);

      // sobre abierto se va
      const REVEAL_AT = T0 + CLOSED_FADE_MS + OPEN_FADE_MS + OPEN_HOLD_MS + WELCOME_OUT_MS + GAP_BEFORE_REVEAL;
      setTimeout(() => {
        coverOpen.classList.add("is-reveal");
      }, REVEAL_AT);

      // ✅ arranca wipe cuando el sobre ya está yéndose
      setTimeout(() => {
        runWipeTransition({ duration: WIPE_MS });
      }, REVEAL_AT + 120);

      // limpiar sobres (no estorban)
      setTimeout(() => {
        coverClosed.style.display = "none";
        coverOpen.style.display = "none";
        if (welcome) welcome.style.display = "none";
      }, REVEAL_AT + 1400);
    });

    /* ===== Burbujas (sin cambios) ===== */
    const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    if (!reduceMotion) {
      const canvas = document.getElementById("bubblesCanvas");
      const ctx = canvas.getContext("2d", { alpha:true });

      function rand(min, max){ return Math.random() * (max - min) + min; }

      function getVP(){
        const vv = window.visualViewport;
        const w = Math.round(vv ? vv.width  : document.documentElement.clientWidth);
        const h = Math.round(vv ? vv.height : document.documentElement.clientHeight);
        return { w, h };
      }

      let vp = getVP();
      let dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));

      const bubbles = [];
      const COUNT = 18;

      const GOLD_PROB = 0.22;
      const GOLD_A_MIN = 0.24;
      const GOLD_A_MAX = 0.46;

      function resizeCanvas(){
        vp = getVP();
        dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));

        canvas.style.width = vp.w + "px";
        canvas.style.height = vp.h + "px";
        canvas.width  = Math.floor(vp.w * dpr);
        canvas.height = Math.floor(vp.h * dpr);

        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

        for (const b of bubbles){
          b.x = Math.min(b.x, Math.max(0, vp.w - b.size));
          b.y = Math.min(b.y, Math.max(0, vp.h - b.size));
        }
      }

      function makeBubble(){
        const size = rand(60, 200);

        const r = Math.random();
        const kind = (r < GOLD_PROB) ? "gold" : (r < (GOLD_PROB + 0.39)) ? "cream" : "white";

        let alpha;
        if (kind === "gold") alpha = rand(GOLD_A_MIN, GOLD_A_MAX);
        else if (kind === "cream") alpha = rand(0.34, 0.70);
        else alpha = rand(0.26, 0.60);

        const angle = rand(0, Math.PI * 2);
        const speed = rand(10, 26);

        return {
          kind,
          size,
          x: rand(0, Math.max(0, vp.w - size)),
          y: rand(0, Math.max(0, vp.h - size)),
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          ax: 0, ay: 0,
          steerLeft: rand(0.6, 1.4),
          alpha
        };
      }

      resizeCanvas();
      for (let i=0; i<COUNT; i++) bubbles.push(makeBubble());

      function drawBubble(b){
        const x = b.x + b.size * 0.5;
        const y = b.y + b.size * 0.5;
        const r = b.size * 0.5;

        const hx = x - r * 0.24;
        const hy = y - r * 0.24;

        if (b.kind === "gold"){
          ctx.fillStyle = `rgba(241,209,138,${0.22 * b.alpha})`;
          ctx.beginPath();
          ctx.arc(x, y, r, 0, Math.PI * 2);
          ctx.fill();

          const g = ctx.createRadialGradient(hx, hy, r * 0.06, x, y, r);
          g.addColorStop(0.00, `rgba(255,255,255,${0.85 * b.alpha})`);
          g.addColorStop(0.16, `rgba(255,255,255,${0.28 * b.alpha})`);
          g.addColorStop(0.38, `rgba(241,209,138,${0.62 * b.alpha})`);
          g.addColorStop(0.70, `rgba(201,151,43,${0.32 * b.alpha})`);
          g.addColorStop(0.86, `rgba(201,151,43,${0.14 * b.alpha})`);
          g.addColorStop(1.00, `rgba(255,255,255,0)`);

          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(x, y, r, 0, Math.PI * 2);
          ctx.fill();

          ctx.strokeStyle = `rgba(255,255,255,${0.22 * b.alpha})`;
          ctx.lineWidth = 1;
          ctx.stroke();
          return;
        }

        const g = ctx.createRadialGradient(hx, hy, r * 0.10, x, y, r);

        if (b.kind === "cream"){
          g.addColorStop(0.00, `rgba(255,255,255,${0.55 * b.alpha})`);
          g.addColorStop(0.60, `rgba(255,248,235,${0.85 * b.alpha})`);
          g.addColorStop(1.00, `rgba(255,255,255,0)`);
        } else {
          g.addColorStop(0.00, `rgba(255,255,255,${0.50 * b.alpha})`);
          g.addColorStop(0.65, `rgba(255,255,255,${0.35 * b.alpha})`);
          g.addColorStop(1.00, `rgba(255,255,255,0)`);
        }

        ctx.fillStyle = g;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = `rgba(255,255,255,${0.18 * b.alpha})`;
        ctx.lineWidth = 1;
        ctx.stroke();
      }

      function onResizeLike(){ resizeCanvas(); }
      window.addEventListener("resize", onResizeLike, { passive:true });
      window.addEventListener("orientationchange", onResizeLike, { passive:true });
      if (window.visualViewport){
        window.visualViewport.addEventListener("resize", onResizeLike, { passive:true });
        window.visualViewport.addEventListener("scroll", onResizeLike, { passive:true });
      }

      let last = performance.now();

      function tick(now){
        const dt = Math.min(0.033, (now - last) / 1000);
        last = now;

        ctx.clearRect(0, 0, vp.w, vp.h);

        for (const b of bubbles){
          b.steerLeft -= dt;
          if (b.steerLeft <= 0){
            b.steerLeft = rand(0.6, 1.4);
            b.ax = rand(-18, 18);
            b.ay = rand(-18, 18);
          }

          b.vx += b.ax * dt;
          b.vy += b.ay * dt;

          const vmax = 32;
          const v = Math.hypot(b.vx, b.vy) || 1;
          if (v > vmax){
            b.vx = (b.vx / v) * vmax;
            b.vy = (b.vy / v) * vmax;
          }

          b.x += b.vx * dt;
          b.y += b.vy * dt;

          const maxX = Math.max(0, vp.w - b.size);
          const maxY = Math.max(0, vp.h - b.size);

          if (b.x <= 0){ b.x = 0; b.vx = Math.abs(b.vx); }
          if (b.x >= maxX){ b.x = maxX; b.vx = -Math.abs(b.vx); }
          if (b.y <= 0){ b.y = 0; b.vy = Math.abs(b.vy); }
          if (b.y >= maxY){ b.y = maxY; b.vy = -Math.abs(b.vy); }

          drawBubble(b);
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    }
  </script>
</body>
</html>
