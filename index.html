<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>J & V — Invitación de Boda</title>

  <style>
:root{
  --bGold: rgba(201,151,43,.34);
  --bChamp: rgba(241,209,138,.32);
  --bCream: rgba(255,248,235,.34);
  --bWhite: rgba(255,255,255,.26);
  --easeWarm: cubic-bezier(.18,.86,.22,1);

  /* Página blanca (sitio) */
  --siteText: #222;
  --siteMuted: rgba(0,0,0,.60);
  --siteLine: rgba(0,0,0,.10);
  --siteMax: 1080px;

  /* Hero / slider */
  --heroRadius: 26px;
  --heroH: clamp(280px, 52vh, 520px);
  --marqueeDur: 28s; /* velocidad del movimiento (más bajo = más rápido) */
}

*{ box-sizing:border-box; }
img{ max-width:100%; height:auto; }
html, body{ width:100%; height:100%; margin:0; }
html{ scroll-behavior:smooth; }

body{
  display:grid;
  place-items:center;

  min-height:100vh;
  min-height:100svh;
  min-height:100dvh;

  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#fff;
  overflow:hidden;
  padding:18px;
  text-align:center;
  color:#222;
  position:relative;
}

/* ===========================
   PORTADA (sobre) + fondo
   =========================== */

.bg-base{
  position:fixed;
  inset:0;
  z-index:0;
  background: linear-gradient(135deg,
    #ffffff 0%,
    #fff6e6 25%,
    #f1d18a 55%,
    #fffaf1 80%,
    #ffffff 100%);
  background-size:300% 300%;
  animation: baseMove 7s ease-in-out infinite;
  pointer-events:none;
  will-change: filter, opacity;
}

#bubblesCanvas{
  position:fixed;
  inset:0;
  z-index:1;
  pointer-events:none;
  display:block;
  opacity:0.92;
  mix-blend-mode: normal;
  filter: saturate(1.06) contrast(1.10);
  will-change: filter, opacity;
}

.shimmer{
  position:fixed;
  inset:-25%;
  z-index:2;
  pointer-events:none;
  background: linear-gradient(115deg,
    rgba(255,255,255,0) 0%,
    rgba(241,209,138,.65) 45%,
    rgba(255,255,255,0) 60%
  );
  filter: blur(10px);
  opacity:.5;
  animation: shimmerMove 7s ease-in-out infinite;
  will-change: filter, opacity, transform;
}

@keyframes baseMove{
  0%{ background-position:0% 50%; }
  50%{ background-position:100% 50%; }
  100%{ background-position:0% 50%; }
}
@keyframes shimmerMove{
  0%{ transform:translateX(-40%) rotate(6deg); }
  50%{ transform:translateX(10%) rotate(6deg); }
  100%{ transform:translateX(45%) rotate(6deg); }
}

/* Sobres */
.cover{
  width: min(720px, 92vw);
  max-height: 86svh;
  max-height: 86dvh;
  height: auto;
  display:block;
  cursor:pointer;
  user-select:none;
  -webkit-user-drag:none;

  filter: drop-shadow(0 18px 35px rgba(0,0,0,.16));
  transition: transform .25s ease, filter .25s ease, opacity .25s ease;
  will-change: transform, opacity, filter;
}
@media (min-width: 900px){
  .cover{ width: clamp(468px, 34vw, 684px); max-height: 82vh; }
}
@media (max-width: 520px){
  .cover{ width: 92vw; max-height: 84svh; max-height: 84dvh; }
}

.cover-wrap{
  position: relative;
  display: grid;
  place-items: center;
  z-index:10;
  will-change: filter, opacity;
}

.hint{
  position: absolute;
  left: 50%;
  bottom: 10%;
  transform: translateX(-50%);
  width: 92%;
  max-width: 520px;

  font-size: 1.15rem;
  letter-spacing: 1.6px;
  color: rgba(80,80,80,.72);
  text-transform: uppercase;

  opacity: 0;
  animation: hintIn .7s ease forwards;
  animation-delay: 1s;

  pointer-events: none;
  user-select: none;
}
@keyframes hintIn{
  from{ opacity:0; transform: translateX(-50%) translateY(6px); }
  to  { opacity:1; transform: translateX(-50%) translateY(0); }
}
@media (max-width: 520px){
  .hint{
    bottom: 14%;
    font-size: .95rem;
    letter-spacing: 1.2px;
  }
}

/* Transición sobres */
.cover-open{
  position:absolute;
  opacity:0;
  visibility:hidden;
  transform: translateY(10px) scale(0.99);
  pointer-events:none;
  transition:
    opacity 1.30s var(--easeWarm),
    transform 1.30s var(--easeWarm);
}
.cover.is-press{
  transform: scale(0.985);
  filter: drop-shadow(0 12px 26px rgba(0,0,0,.14));
}
.cover.is-fadeout{
  opacity:0;
  transform: translateY(-6px) scale(0.995);
  filter: drop-shadow(0 18px 35px rgba(0,0,0,.12));
  transition:
    opacity 1.30s var(--easeWarm),
    transform 1.30s var(--easeWarm),
    filter 1.30s var(--easeWarm);
}
.cover-open.is-show{
  opacity:1;
  visibility:visible;
  transform: translateY(0) scale(1);
}
.cover-open.is-reveal{
  opacity:0;
  transform: translateY(-10px) scale(1.01);
  transition:
    opacity 1.10s var(--easeWarm),
    transform 1.10s var(--easeWarm);
}

/* Texto Bienvenidos */
.welcome{
  position:absolute;
  left:50%;
  bottom: 6.8%;
  transform: translateX(-50%);
  width: 92%;
  max-width: 560px;

  font-family: "Georgia", "Times New Roman", serif;
  font-size: 1.15rem;
  letter-spacing: 1.2px;

  color: rgba(166, 128, 56, .78);
  text-shadow: 0 1px 0 rgba(255,255,255,.35);

  opacity: 0;
  pointer-events:none;
  user-select:none;

  animation: none;
  will-change: opacity, transform;
}
.welcome.is-animate{ animation: hintIn .7s ease forwards; }

@keyframes welcomeOut{
  from{ opacity:1; transform: translateX(-50%) translateY(0); }
  to  { opacity:0; transform: translateX(-50%) translateY(-6px); }
}
.welcome.is-out{ animation: welcomeOut .85s var(--easeWarm) forwards; }

@media (max-width: 520px){
  .welcome{
    bottom: 10.5%;
    font-size: 1.00rem;
    letter-spacing: 1.0px;
  }
}

/* =========================================================
   WIPE ROBUSTO (cross-browser): scale + feather + blanco sólido
   ========================================================= */

#wipe{
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0;
  transform: translateZ(0);
  will-change: opacity;
}

#wipe::before{
  content:"";
  position:absolute;
  left:0;
  top:0;

  width: 300vmax;
  height: 300vmax;

  background: radial-gradient(
    circle at 0 0,
    rgba(255,255,255,1) 0%,
    rgba(255,255,255,1) 62%,
    rgba(255,255,255,.95) 66%,
    rgba(255,255,255,0) 74%,
    rgba(255,255,255,0) 100%
  );

  transform-origin: 0 0;
  transform: scale(0.02);
  filter: blur(0px);

  will-change: transform, filter;
}

#wipe::after{
  content:"";
  position:absolute;
  inset:0;
  background:#fff;
  opacity:0;
  will-change: opacity;
}

body.is-wiping #wipe{ opacity: 1; }

body.is-wiping #wipe::before{
  animation: wipeExpand var(--wipeDur, 3600ms) var(--easeWarm) forwards;
}
body.is-wiping #wipe::after{
  animation: wipeFullWhite var(--wipeDur, 3600ms) var(--easeWarm) forwards;
}

@keyframes wipeExpand{
  0%{ transform: scale(0.02); filter: blur(0px); }
  55%{ transform: scale(0.55); filter: blur(10px); }
  85%{ transform: scale(0.95); filter: blur(14px); }
  100%{ transform: scale(1.08); filter: blur(18px); }
}

@keyframes wipeFullWhite{
  0%   { opacity:0; }
  80%  { opacity:0; }
  92%  { opacity:0.25; }
  97%  { opacity:0.70; }
  100% { opacity:1; }
}

/* blur progresivo del “mundo” mientras entra el wipe */
.bg-base, #bubblesCanvas, .shimmer, #coverWrap{
  transition:
    filter var(--wipeDur, 3600ms) var(--easeWarm),
    opacity var(--wipeDur, 3600ms) var(--easeWarm);
}
body.is-wiping #bubblesCanvas{ filter: saturate(1.03) contrast(1.07) blur(18px); opacity: .25; }
body.is-wiping .shimmer{ filter: blur(28px); opacity: .10; }
body.is-wiping .bg-base{ filter: blur(16px); opacity: .30; }
body.is-wiping #coverWrap{ filter: blur(14px); opacity: .15; }

/* ===========================
   SITIO (pantalla blanca)
   =========================== */

#site{
  position: fixed;
  inset: 0;
  z-index: 20;

  display: none;            /* se “monta” en JS para precargar layout */
  opacity: 0;               /* se hace visible al final del wipe */

  background: #fff;
  color: var(--siteText);

  overflow: auto;
  -webkit-overflow-scrolling: touch;

  transition: opacity .35s ease;
}

/* Header como la imagen: centrado y “clean” */
.topbar{
  position: sticky;
  top: 0;
  z-index: 5;
  background: #fff;
  border-bottom: 1px solid var(--siteLine);
}

.topbar-inner{
  max-width: var(--siteMax);
  margin: 0 auto;
  padding:
    calc(14px + env(safe-area-inset-top)) 18px
    10px;
  text-align: center;
}

.couple-name{
  font-family: "Georgia", "Times New Roman", serif;
  font-weight: 400;
  letter-spacing: 2.4px;
  text-transform: uppercase;
  color: #222;
  font-size: clamp(22px, 3.2vw, 34px);
  margin: 4px 0 10px;
}

.nav{
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 18px;
  flex-wrap: wrap;
  padding: 8px 0 6px;
  border-top: 1px solid var(--siteLine);
}

.nav a{
  text-decoration:none;
  color: rgba(0,0,0,.62);
  font-size: 12px;
  letter-spacing: 1px;
  text-transform: uppercase;
  padding: 8px 6px;
  position: relative;
}

.nav a::after{
  content:"";
  position:absolute;
  left: 8px;
  right: 8px;
  bottom: 4px;
  height: 1px;
  background: rgba(0,0,0,.22);
  transform: scaleX(0);
  transform-origin: center;
  transition: transform .22s ease;
}

.nav a:hover::after,
.nav a:focus-visible::after{ transform: scaleX(1); }

.nav a.is-active{ color: rgba(0,0,0,.75); }
.nav a.is-active::after{ transform: scaleX(1); }

/* Botón menú (solo móvil) */
.nav-toggle{
  display:none;
  border: 1px solid var(--siteLine);
  background:#fff;
  padding: 10px 12px;
  border-radius: 10px;
  font-size: 13px;
  letter-spacing: .8px;
  margin: 2px auto 10px;
}

/* Contenido */
.site-shell{
  max-width: var(--siteMax);
  margin: 0 auto;
  padding: 0 18px 60px;
}

/* ==============
   HERO: Slider lateral + Letras al centro
   ============== */

.hero{
  padding: 18px 0 10px;
}

.hero-media{
  position: relative;
  height: var(--heroH);

  /* FIX “bordes blancos”: forzamos fondo oscuro y recorte limpio */
  background: #000;
  border-radius: var(--heroRadius);
  overflow: hidden;

  /* ayuda a evitar halos/anti-alias en algunos móviles */
  isolation: isolate;
  transform: translateZ(0);
  backface-visibility: hidden;
}

.marquee{
  position:absolute;
  inset:0;
  overflow:hidden;
  background:#000;
  transform: translateZ(0);
}

.marquee-track{
  position:absolute;
  top:0; left:0;
  height:100%;
  display:flex;
  gap: 0;                 /* IMPORTANTE: sin separaciones */
  width: max-content;
  will-change: transform;
  transform: translate3d(0,0,0);
  animation: marqueeMove var(--marqueeDur) linear infinite;
}

/* Cada imagen del “slice” */
.marquee-item{
  height:100%;
  width: clamp(260px, 55vw, 560px); /* “paneles” grandes como ejemplo */
  flex: 0 0 auto;
  transform: translateZ(0);
}

.marquee-item img{
  width:100%;
  height:100%;
  object-fit: cover;
  display:block;

  /* FIX “líneas” por subpíxel */
  transform: translateZ(0) scale(1.01);
}

/* Overlay suave (oscurece un poco para que Letras.png resalte) */
.hero-vignette{
  position:absolute;
  inset:0;
  background:
    radial-gradient(ellipse at center, rgba(0,0,0,.18) 0%, rgba(0,0,0,.38) 75%, rgba(0,0,0,.45) 100%);
  pointer-events:none;
  z-index: 2;
}

/* Letras al centro (tu PNG sin fondo) */
.monogram{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%) translateZ(0);
  z-index: 3;
  width: min(72%, 520px);
  max-height: 80%;
  object-fit: contain;
  pointer-events:none;
  user-select:none;

  /* resaltado leve (no crea borde blanco del contenedor) */
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
}

/* Animación infinita hacia la izquierda */
@keyframes marqueeMove{
  from { transform: translate3d(0,0,0); }
  to   { transform: translate3d(-50%,0,0); }
}

/* Ajuste móvil */
@media (max-width: 640px){
  .nav{
    display:none;
    flex-direction: column;
    gap: 8px;
    padding: 12px 0 10px;
  }
  .nav.is-open{ display:flex; }
  .nav-toggle{ display:inline-block; }

  .marquee-item{
    width: clamp(220px, 78vw, 520px);
  }
  :root{
    --marqueeDur: 24s; /* un poco más rápido en móvil */
    --heroRadius: 22px;
  }
}

/* Secciones placeholder */
.section{
  padding: 54px 4px;
  max-width: 920px;
  margin: 0 auto;
  text-align:left;
}
.section h2{
  font-family: "Georgia", "Times New Roman", serif;
  font-weight: 500;
  letter-spacing: 1.2px;
  margin: 0 0 10px;
}
.section p{
  margin: 0;
  color: var(--siteMuted);
  line-height: 1.6;
}

@media (prefers-reduced-motion: reduce){
  .cover, .cover-open, .welcome,
  #wipe,
  #bubblesCanvas, .shimmer, #coverWrap, .bg-base,
  .marquee-track{
    transition:none !important;
    animation:none !important;
    filter:none !important;
    transform:none !important;
  }
}
  </style>
</head>

<body>
  <!-- PORTADA -->
  <div class="bg-base"></div>
  <canvas id="bubblesCanvas"></canvas>
  <div class="shimmer"></div>

  <div class="cover-wrap" id="coverWrap">
    <img src="assets/Sobre-Cerrado.png" alt="Sobre cerrado" class="cover" id="coverClosed" />
    <img src="assets/Sobre.png" alt="Sobre abierto" class="cover cover-open" id="coverOpen" />
    <div class="hint" id="hint">Toca el sobre para abrir</div>
    <div class="welcome" id="welcome">Bienvenidos a nuestra Historia</div>
  </div>

  <!-- WIPE overlay -->
  <div id="wipe" aria-hidden="true"></div>

  <!-- SITIO (PANTALLA BLANCA) -->
  <main id="site" aria-hidden="true">
    <div class="site-shell">
      <header class="topbar" id="home">
        <div class="topbar-inner">
          <div class="couple-name">VALERIA &amp; JONATAN</div>

          <button class="nav-toggle" id="navToggle" type="button" aria-controls="nav" aria-expanded="false">
            Menú
          </button>

          <nav class="nav" id="nav" aria-label="Navegación principal">
            <a href="#home" class="is-active">Home</a>
            <a href="#fecha">Fecha</a>
            <a href="#lugar">Lugar</a>
            <a href="#itinerario">Itinerario</a>
            <a href="#dresscode">Dress Code</a>
          </nav>
        </div>
      </header>

      <!-- ✅ HERO: Slider lateral + Letras.png al centro -->
      <section class="hero" aria-label="Galería">
        <div class="hero-media">
          <div class="marquee" aria-hidden="true">
            <div class="marquee-track">
              <!-- 6 imágenes -->
              <div class="marquee-item"><img src="assets/IMG1.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG2.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG3.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG4.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG5.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG6.jpg" alt=""></div>

              <!-- duplicado para loop perfecto -->
              <div class="marquee-item"><img src="assets/IMG1.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG2.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG3.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG4.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG5.jpg" alt=""></div>
              <div class="marquee-item"><img src="assets/IMG6.jpg" alt=""></div>
            </div>
          </div>

          <!-- Letras al centro (PNG sin fondo) -->
          <img class="monogram" src="assets/Letras.png" alt="Iniciales" />

          <div class="hero-vignette" aria-hidden="true"></div>
        </div>
      </section>

      <!-- Placeholders (para probar scroll). Luego los reemplazamos por tu contenido real -->
      <section class="section" id="fecha">
        <h2>Fecha</h2>
        <p>Sección placeholder. Aquí irá el bloque de “Save the date”, fecha grande y el contador.</p>
      </section>

      <section class="section" id="lugar">
        <h2>Lugar</h2>
        <p>Sección placeholder. Aquí irá el mapa de Google Maps, foto del salón y la iglesia.</p>
      </section>

      <section class="section" id="itinerario">
        <h2>Itinerario</h2>
        <p>Sección placeholder. Aquí irá la imagen del itinerario.</p>
      </section>

      <section class="section" id="dresscode">
        <h2>Dress Code</h2>
        <p>Sección placeholder. Aquí irá el dress code.</p>
      </section>
    </div>
  </main>

  <audio id="bg-music" preload="auto">
    <source src="assets/MusicaparaBoda.m4a" type="audio/mp4">
    Tu navegador no soporta audio.
  </audio>

  <script>
    const coverClosed = document.getElementById("coverClosed");
    const coverOpen   = document.getElementById("coverOpen");
    const music = document.getElementById("bg-music");
    const hint  = document.getElementById("hint");
    const welcome = document.getElementById("welcome");

    const site = document.getElementById("site");
    const nav = document.getElementById("nav");
    const navToggle = document.getElementById("navToggle");
    const wipeEl = document.getElementById("wipe");

    let opened = false;

    function mountSiteHidden(){
      // Monta el sitio antes de terminar el wipe para que aparezca inmediato (sin “delay”)
      if (!site) return;
      site.style.display = "block";
      site.style.opacity = "0";
      site.setAttribute("aria-hidden", "true");
    }

    function revealSite(){
      if (!site) return;
      site.style.opacity = "1";
      site.removeAttribute("aria-hidden");
      // El scroll lo maneja #site (fixed + overflow auto). El body se queda sin scroll.
      document.body.style.overflow = "hidden";
    }

    function runWipeTransition({ duration = 3600 } = {}) {
      document.documentElement.style.setProperty("--wipeDur", duration + "ms");

      // ✅ Pre-montar el sitio (oculto) para evitar “pantalla blanca vacía”
      mountSiteHidden();

      document.body.classList.add("is-wiping");

      // Mostramos el sitio un poco antes (pero sigue tapado por el wipe)
      const SHOW_SITE_AT = Math.round(duration * 0.90);

      // Al final, quitamos el wipe y apagamos el mundo
      const CLEANUP_AT = duration;

      window.setTimeout(() => {
        revealSite();
      }, SHOW_SITE_AT);

      window.setTimeout(() => {
        document.body.style.background = "#fff";

        const canvas = document.getElementById("bubblesCanvas");
        const shimmer = document.querySelector(".shimmer");
        const bg = document.querySelector(".bg-base");
        const wrap = document.getElementById("coverWrap");

        if (canvas) canvas.style.display = "none";
        if (shimmer) shimmer.style.display = "none";
        if (bg) bg.style.display = "none";
        if (wrap) wrap.style.display = "none";

        // ✅ IMPORTANTE: quitar el wipe que está tapando el sitio
        if (wipeEl) wipeEl.style.display = "none";

        // (Opcional) quitar la clase para que no quede “modo transición”
        document.body.classList.remove("is-wiping");

        // asegurar visible
        revealSite();
      }, CLEANUP_AT);
    }

    coverClosed.addEventListener("click", async () => {
      if (opened) return;
      opened = true;

      if (hint) hint.style.display = "none";

      const PRESS_MS = 150;
      const CLOSED_FADE_MS = 1400;
      const OPEN_FADE_MS = 1200;
      const OPEN_HOLD_MS = 2500;

      const WELCOME_DELAY_AFTER_OPEN = 850;
      const WELCOME_OUT_MS = 850;
      const GAP_BEFORE_REVEAL = 180;

      const WIPE_MS = 3800;

      coverClosed.classList.add("is-press");
      setTimeout(() => coverClosed.classList.remove("is-press"), PRESS_MS);

      if (music.paused) {
        music.play().catch(e => console.error("No se pudo reproducir audio:", e));
      }

      const T0 = 120;

      setTimeout(() => { coverClosed.classList.add("is-fadeout"); }, T0);

      setTimeout(() => { coverOpen.classList.add("is-show"); }, T0 + CLOSED_FADE_MS);

      setTimeout(() => { if (welcome) welcome.classList.add("is-animate"); },
        T0 + CLOSED_FADE_MS + WELCOME_DELAY_AFTER_OPEN
      );

      setTimeout(() => { if (welcome) welcome.classList.add("is-out"); },
        T0 + CLOSED_FADE_MS + OPEN_FADE_MS + OPEN_HOLD_MS
      );

      const REVEAL_AT = T0 + CLOSED_FADE_MS + OPEN_FADE_MS + OPEN_HOLD_MS + WELCOME_OUT_MS + GAP_BEFORE_REVEAL;
      setTimeout(() => { coverOpen.classList.add("is-reveal"); }, REVEAL_AT);

      setTimeout(() => { runWipeTransition({ duration: WIPE_MS }); }, REVEAL_AT + 120);

      setTimeout(() => {
        coverClosed.style.display = "none";
        coverOpen.style.display = "none";
        if (welcome) welcome.style.display = "none";
      }, REVEAL_AT + 1400);
    });

    /* ===== Menú móvil ===== */
    if (navToggle && nav){
      navToggle.addEventListener("click", () => {
        const isOpen = nav.classList.toggle("is-open");
        navToggle.setAttribute("aria-expanded", String(isOpen));
      });

      nav.addEventListener("click", (e) => {
        const a = e.target.closest("a");
        if (!a) return;
        if (window.matchMedia("(max-width: 640px)").matches){
          nav.classList.remove("is-open");
          navToggle.setAttribute("aria-expanded", "false");
        }
      });
    }

    /* ===== Burbujas (sin cambios) ===== */
    const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    if (!reduceMotion) {
      const canvas = document.getElementById("bubblesCanvas");
      const ctx = canvas.getContext("2d", { alpha:true });

      function rand(min, max){ return Math.random() * (max - min) + min; }

      function getVP(){
        const vv = window.visualViewport;
        const w = Math.round(vv ? vv.width  : document.documentElement.clientWidth);
        const h = Math.round(vv ? vv.height : document.documentElement.clientHeight);
        return { w, h };
      }

      let vp = getVP();
      let dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));

      const bubbles = [];
      const COUNT = 18;

      const GOLD_PROB = 0.22;
      const GOLD_A_MIN = 0.24;
      const GOLD_A_MAX = 0.46;

      function resizeCanvas(){
        vp = getVP();
        dpr = Math.max(1, Math.min(2.5, window.devicePixelRatio || 1));

        canvas.style.width = vp.w + "px";
        canvas.style.height = vp.h + "px";
        canvas.width  = Math.floor(vp.w * dpr);
        canvas.height = Math.floor(vp.h * dpr);

        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

        for (const b of bubbles){
          b.x = Math.min(b.x, Math.max(0, vp.w - b.size));
          b.y = Math.min(b.y, Math.max(0, vp.h - b.size));
        }
      }

      function makeBubble(){
        const size = rand(60, 200);

        const r = Math.random();
        const kind = (r < GOLD_PROB) ? "gold" : (r < (GOLD_PROB + 0.39)) ? "cream" : "white";

        let alpha;
        if (kind === "gold") alpha = rand(GOLD_A_MIN, GOLD_A_MAX);
        else if (kind === "cream") alpha = rand(0.34, 0.70);
        else alpha = rand(0.26, 0.60);

        const angle = rand(0, Math.PI * 2);
        const speed = rand(10, 26);

        return {
          kind,
          size,
          x: rand(0, Math.max(0, vp.w - size)),
          y: rand(0, Math.max(0, vp.h - size)),
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          ax: 0, ay: 0,
          steerLeft: rand(0.6, 1.4),
          alpha
        };
      }

      resizeCanvas();
      for (let i=0; i<COUNT; i++) bubbles.push(makeBubble());

      function drawBubble(b){
        const x = b.x + b.size * 0.5;
        const y = b.y + b.size * 0.5;
        const r = b.size * 0.5;

        const hx = x - r * 0.24;
        const hy = y - r * 0.24;

        if (b.kind === "gold"){
          ctx.fillStyle = `rgba(241,209,138,${0.22 * b.alpha})`;
          ctx.beginPath();
          ctx.arc(x, y, r, 0, Math.PI * 2);
          ctx.fill();

          const g = ctx.createRadialGradient(hx, hy, r * 0.06, x, y, r);
          g.addColorStop(0.00, `rgba(255,255,255,${0.85 * b.alpha})`);
          g.addColorStop(0.16, `rgba(255,255,255,${0.28 * b.alpha})`);
          g.addColorStop(0.38, `rgba(241,209,138,${0.62 * b.alpha})`);
          g.addColorStop(0.70, `rgba(201,151,43,${0.32 * b.alpha})`);
          g.addColorStop(0.86, `rgba(201,151,43,${0.14 * b.alpha})`);
          g.addColorStop(1.00, `rgba(255,255,255,0)`);

          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(x, y, r, 0, Math.PI * 2);
          ctx.fill();

          ctx.strokeStyle = `rgba(255,255,255,${0.22 * b.alpha})`;
          ctx.lineWidth = 1;
          ctx.stroke();
          return;
        }

        const g = ctx.createRadialGradient(hx, hy, r * 0.10, x, y, r);

        if (b.kind === "cream"){
          g.addColorStop(0.00, `rgba(255,255,255,${0.55 * b.alpha})`);
          g.addColorStop(0.60, `rgba(255,248,235,${0.85 * b.alpha})`);
          g.addColorStop(1.00, `rgba(255,255,255,0)`);
        } else {
          g.addColorStop(0.00, `rgba(255,255,255,${0.50 * b.alpha})`);
          g.addColorStop(0.65, `rgba(255,255,255,${0.35 * b.alpha})`);
          g.addColorStop(1.00, `rgba(255,255,255,0)`);
        }

        ctx.fillStyle = g;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = `rgba(255,255,255,${0.18 * b.alpha})`;
        ctx.lineWidth = 1;
        ctx.stroke();
      }

      function onResizeLike(){ resizeCanvas(); }
      window.addEventListener("resize", onResizeLike, { passive:true });
      window.addEventListener("orientationchange", onResizeLike, { passive:true });
      if (window.visualViewport){
        window.visualViewport.addEventListener("resize", onResizeLike, { passive:true });
        window.visualViewport.addEventListener("scroll", onResizeLike, { passive:true });
      }

      let last = performance.now();

      function tick(now){
        const dt = Math.min(0.033, (now - last) / 1000);
        last = now;

        ctx.clearRect(0, 0, vp.w, vp.h);

        for (const b of bubbles){
          b.steerLeft -= dt;
          if (b.steerLeft <= 0){
            b.steerLeft = rand(0.6, 1.4);
            b.ax = rand(-18, 18);
            b.ay = rand(-18, 18);
          }

          b.vx += b.ax * dt;
          b.vy += b.ay * dt;

          const vmax = 32;
          const v = Math.hypot(b.vx, b.vy) || 1;
          if (v > vmax){
            b.vx = (b.vx / v) * vmax;
            b.vy = (b.vy / v) * vmax;
          }

          b.x += b.vx * dt;
          b.y += b.vy * dt;

          const maxX = Math.max(0, vp.w - b.size);
          const maxY = Math.max(0, vp.h - b.size);

          if (b.x <= 0){ b.x = 0; b.vx = Math.abs(b.vx); }
          if (b.x >= maxX){ b.x = maxX; b.vx = -Math.abs(b.vx); }
          if (b.y <= 0){ b.y = 0; b.vy = Math.abs(b.vy); }
          if (b.y >= maxY){ b.y = maxY; b.vy = -Math.abs(b.vy); }

          drawBubble(b);
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    }
  </script>
</body>
</html>
